\section{Related work}
The problem of detecting malicious macros inside Office documents has determined the creation of multiple analysis tools meant to help researchers and, in recent years, multiple studies were conducted to test new methods of detecting malicious files. The main focus of these methods are the structural properties of the macro code which derive from obfuscation or features that try to describe general aspects of the code and behavioral features. 
\par
In addition to having analysis capabilities, the mentioned tools are also aimed at detecting malicious traits inside Office files. OfficeMalScanner\footnote{http://www.reconstructer.org/about.html},  OfficeCAT\footnote{https://www.aldeid.com/wiki/Officecat}, Microsoft OffVis\footnote{https://www.aldeid.com/wiki/OffVis} and pyOLEScanner\footnote{https://www.aldeid.com/wiki/PyOLEScanner} are tools which can be used to scan for malicious traces and vulnerabilities inside Office files in OLE format (.doc, .xls, .ppt). 
\par
A machine learning approach to malicious macro detection was presented by Sangwoo Kim et al.\cite{KimHOL18} It is based on 15 discriminant static features that describe certain obfuscation techniques used in the code. These features are associated with four types of obfuscation methods: random obfuscation, split obfuscation, encoding obfuscation and logic obfuscation. The training was performed on a set of 2,537 files (773 benign, 1,764 malicious) and five classifiers were tested: SVM (95,5\%), Random Forest (96,5\%), Multi-Layer Perceptron (97\%), Linear Discriminant Analysis (90,1\%) and Bernoulli Naive Bayes (89,1\%). 
\par
A similar approach to macro detection is described by Ed Aboud and Darragh O'Brien\cite{AboudO18}. They are using features based on the macro found inside Office files which can describe more generic properties of the VBA code, such as Macro Keywords, Count of Integer Variables, etc. Additionally, an OCR library is used to identify certain phrases used in social engineering attacks such as Enable Content and Previous Version. Using the extracted characteristics, they created a feature vector which was the input for five different classifiers. The training was performed on a set of 400 samples (200 benign, 200 malicious) and the testing phase consisted of 528 malicious samples and 83 benign samples. The performance of these classifiers was evaluated in terms of the TPR (True Positives Rate): Random Forest (98,9875\%), KNeighbors (97,527\%), DecisionTree (98,225\%), GaussianNB (97,02\%).
\par
In "Macro Malware Detection using Machine Learning Techniques"\cite{SantosT17}, Sergio De los Santos and Jose Torres propose the idea of using the features extracted by the python libraries OleFile and OleVBA. Their system was trained  using the following classifiers with the following accuracy values during the test phase: SVM (89\%),  Decision Tree (95\%), Random Forest (94\%) and Neural Networks (99\%). 
\par
ALDOCX is a framework implemented by Nisam et al.\cite{NissimCE17} based on machine learning classifiers, which uses features related to the structure of the paths in a ZIP archive, a methodology named SFEM. The extracted properties serve as input for an SVM classifier paired with an Active Learning component, which allows the system to continuously update the detection model. The classifier was trained on a set of 16,811 samples (327 malicious, 16,484 benign) and achieved a TPR of 93.34\%, FPR (False Positives Rate) of 0.19\% and 99.67\% accuracy. It is important to point out that, due to the process of choosing the features (they are paths inside a zip file), this framework only supports the newer OOXML file format (.docx, .xlsx) of Office files.
\par
As we can observe from the research work and tools mentioned above, most of the detection techniques are based around obfuscation, dynamic analysis, static, signature-based evaluation or a rather low number of features extracted from the macro code inside the VBA project found in Office files.
In the following sections, we will present our solution regarding the detection of malicious macro code using features which can describe the sample space in a more generic manner.